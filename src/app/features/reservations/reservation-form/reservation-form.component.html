<div class="max-w-4xl mx-auto space-y-6 animate-fade-in pb-12">
  
  <div class="flex items-center space-x-4 mb-4">
    <button (click)="location.back()" class="w-10 h-10 rounded-full bg-white border border-slate-200 shadow-sm flex items-center justify-center text-slate-500 hover:text-primary-600 hover:border-primary-200 transition-all">
      <i class="fa-solid fa-arrow-left"></i>
    </button>
    <div>
      <h1 class="text-2xl font-bold text-slate-800">{{ isEditMode ? 'Edit Reservation' : 'Create New Booking' }}</h1>
      <p class="text-sm text-slate-500 mt-0.5">Fill in the details below to {{ isEditMode ? 'update the' : 'register a new' }} booking.</p>
    </div>
  </div>

  <div *ngIf="loading" class="card h-64 flex items-center justify-center">
    <div class="inline-block animate-spin w-8 h-8 border-4 border-solid border-primary-500 border-r-transparent rounded-full"></div>
  </div>

  <form *ngIf="!loading" [formGroup]="form" (ngSubmit)="onSubmit()" class="space-y-6">
    
    <!-- Primary Details Section -->
    <div class="card p-8">
      <h2 class="text-lg font-bold text-slate-800 mb-6 flex items-center border-b border-slate-100 pb-3">
        <i class="fa-solid fa-circle-info text-primary-500 mr-2"></i> Booking Information
      </h2>
      
      <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-5">
        
        <!-- Booking Code -->
        <div>
          <label class="block text-sm font-semibold text-slate-700 mb-1">Booking Code / Voucher *</label>
          <input type="text" formControlName="booking_code" class="block w-full border-slate-200 rounded-lg shadow-sm focus:ring-primary-500 focus:border-primary-500 sm:text-sm px-4 py-2 bg-slate-50" placeholder="e.g. BKG-10293">
          <p *ngIf="form.get('booking_code')?.touched && form.get('booking_code')?.errors?.['required']" class="text-red-500 text-xs mt-1 font-medium">Booking code is required.</p>
        </div>

        <!-- Agency -->
        <div>
          <label class="block text-sm font-semibold text-slate-700 mb-1">Agency Source *</label>
          <select formControlName="agency" class="block w-full border-slate-200 rounded-lg shadow-sm focus:ring-primary-500 focus:border-primary-500 sm:text-sm px-4 py-2 bg-slate-50">
            <option value="BOOKING.COM">Booking.com</option>
            <option value="EXPEDIA">Expedia</option>
            <option value="AGODA">Agoda</option>
            <option value="DIRECT">Direct (Web)</option>
            <option value="BEDBANKGLOBAL">BedBankGlobal</option>
            <option value="PAXIMUM">Paximum</option>
            <option value="YUPPI">Yuppi</option>
          </select>
        </div>
        
        <!-- Status -->
        <div>
          <label class="block text-sm font-semibold text-slate-700 mb-1">Reservation Status</label>
          <select formControlName="status" class="block w-full border-slate-200 rounded-lg shadow-sm focus:ring-primary-500 focus:border-primary-500 sm:text-sm px-4 py-2 bg-slate-50">
            <option value="OK">Confirmed (OK)</option>
            <option value="PENDING">Pending Checkout</option>
            <option value="CXX">Cancelled</option>
          </select>
        </div>

      </div>
    </div>
    
    <!-- Client Details Section -->
    <div class="card p-8">
      <h2 class="text-lg font-bold text-slate-800 mb-6 flex items-center border-b border-slate-100 pb-3">
        <i class="fa-solid fa-users text-primary-500 mr-2"></i> Client Details
      </h2>
      
      <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-5">
        
        <!-- Clients Names -->
        <div class="md:col-span-2">
          <label class="block text-sm font-semibold text-slate-700 mb-1">Lead Guest Name(s) *</label>
          <input type="text" formControlName="clients_names" class="block w-full border-slate-200 rounded-lg shadow-sm focus:ring-primary-500 focus:border-primary-500 sm:text-sm px-4 py-2 bg-slate-50" placeholder="e.g. JOHN DOE, JANE DOE">
        </div>
        
        <!-- Nationality -->
        <div>
          <label class="block text-sm font-semibold text-slate-700 mb-1">Nationality *</label>
          <input type="text" formControlName="nationality" class="block w-full border-slate-200 rounded-lg shadow-sm focus:ring-primary-500 focus:border-primary-500 sm:text-sm px-4 py-2 bg-slate-50" placeholder="e.g. SPAIN, USA">
        </div>

      </div>
    </div>

    <!-- Hotel & Dates Section -->
    <div class="card p-8 bg-gradient-to-br from-white to-slate-50">
      <h2 class="text-lg font-bold text-slate-800 mb-6 flex items-center border-b border-slate-200 pb-3">
        <i class="fa-solid fa-hotel text-indigo-500 mr-2"></i> Hotel & Stay Information
      </h2>
      
      <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-5">
        
        <!-- Hotel Name -->
        <div>
          <label class="block text-sm font-semibold text-slate-700 mb-1">Hotel Property *</label>
          <input type="text" formControlName="hotel" class="block w-full border-slate-300 rounded-lg shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm px-4 py-2 bg-white" placeholder="Grand Resort Spa">
        </div>
        
        <!-- Hotel Confirmation -->
        <div>
          <label class="block text-sm font-semibold text-slate-700 mb-1">Hotel Confirmation ID</label>
          <input type="text" formControlName="hotel_confirmation" class="block w-full border-slate-300 rounded-lg shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm px-4 py-2 bg-white" placeholder="Optional hotel ref">
        </div>
        
        <!-- Check In -->
        <div>
          <label class="block text-sm font-semibold text-slate-700 mb-1">Check-in Date *</label>
          <input type="date" formControlName="date_from" class="block w-full border-slate-300 rounded-lg shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm px-4 py-2 bg-white text-slate-700">
        </div>
        
        <!-- Check Out -->
        <div>
          <label class="block text-sm font-semibold text-slate-700 mb-1">Check-out Date *</label>
          <input type="date" formControlName="date_to" class="block w-full border-slate-300 rounded-lg shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm px-4 py-2 bg-white text-slate-700">
        </div>

        <!-- Meal Plan -->
        <div class="md:col-span-2 shadow-inner bg-white rounded-lg p-4 border border-slate-100">
          <label class="block text-sm font-semibold text-slate-700 mb-3">Meal Plan / Board Type</label>
          <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
             <label class="flex items-center space-x-2 p-2 border border-slate-200 rounded cursor-pointer hover:bg-indigo-50 transition-colors" [class.bg-indigo-50]="form.get('meal_plan')?.value === 'ROOM ONLY'" [class.border-indigo-300]="form.get('meal_plan')?.value === 'ROOM ONLY'">
               <input type="radio" formControlName="meal_plan" value="ROOM ONLY" class="text-indigo-600 focus:ring-indigo-500">
               <span class="text-xs font-semibold text-slate-700">Room Only</span>
             </label>
             <label class="flex items-center space-x-2 p-2 border border-slate-200 rounded cursor-pointer hover:bg-indigo-50 transition-colors" [class.bg-indigo-50]="form.get('meal_plan')?.value === 'BED & BREAKFAST'" [class.border-indigo-300]="form.get('meal_plan')?.value === 'BED & BREAKFAST'">
               <input type="radio" formControlName="meal_plan" value="BED & BREAKFAST" class="text-indigo-600 focus:ring-indigo-500">
               <span class="text-xs font-semibold text-slate-700">Bed & Breakf.</span>
             </label>
             <label class="flex items-center space-x-2 p-2 border border-slate-200 rounded cursor-pointer hover:bg-indigo-50 transition-colors" [class.bg-indigo-50]="form.get('meal_plan')?.value === 'HALF BOARD'" [class.border-indigo-300]="form.get('meal_plan')?.value === 'HALF BOARD'">
               <input type="radio" formControlName="meal_plan" value="HALF BOARD" class="text-indigo-600 focus:ring-indigo-500">
               <span class="text-xs font-semibold text-slate-700">Half Board</span>
             </label>
             <label class="flex items-center space-x-2 p-2 border border-slate-200 rounded cursor-pointer hover:bg-indigo-50 transition-colors" [class.bg-indigo-50]="form.get('meal_plan')?.value === 'ALL INCLUSIVE'" [class.border-indigo-300]="form.get('meal_plan')?.value === 'ALL INCLUSIVE'">
               <input type="radio" formControlName="meal_plan" value="ALL INCLUSIVE" class="text-indigo-600 focus:ring-indigo-500">
               <span class="text-xs font-semibold text-slate-700">All Inclusive</span>
             </label>
          </div>
        </div>

      </div>
    </div>

    <!-- Financials Section -->
    <div class="card p-8">
      <h2 class="text-lg font-bold text-slate-800 mb-6 flex items-center border-b border-slate-100 pb-3">
         <i class="fa-solid fa-sack-dollar text-green-500 mr-2"></i> Financial Calculation
      </h2>
      
      <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-5 items-end">
        <!-- Touch Cost -->
        <div>
          <label class="block text-sm font-semibold text-slate-700 mb-1">Net Cost (Touch) *</label>
          <div class="relative">
            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
              <span class="text-slate-500 sm:text-sm">$</span>
            </div>
            <input type="number" step="0.01" formControlName="touch_cost" class="block w-full pl-7 pr-12 border-slate-200 rounded-lg shadow-sm focus:ring-green-500 focus:border-green-500 sm:text-sm py-2 bg-slate-50" placeholder="0.00">
            <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
              <span class="text-slate-500 sm:text-sm">USD</span>
            </div>
          </div>
        </div>

        <!-- Sale Price -->
        <div>
          <label class="block text-sm font-semibold text-slate-700 mb-1">Sale Price *</label>
          <div class="relative">
            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
              <span class="text-slate-500 sm:text-sm">$</span>
            </div>
            <input type="number" step="0.01" formControlName="sale_price" class="block w-full pl-7 pr-12 border-slate-200 rounded-lg shadow-sm focus:ring-green-500 focus:border-green-500 sm:text-sm py-2 bg-slate-50" placeholder="0.00">
            <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
              <span class="text-slate-500 sm:text-sm">USD</span>
            </div>
          </div>
        </div>
        
        <div class="md:col-span-2 pt-4">
           <label class="block text-sm font-semibold text-slate-700 mb-1">Internal Notes & Remarks</label>
           <textarea formControlName="remarks" rows="3" class="block w-full border-slate-200 rounded-lg shadow-sm focus:ring-primary-500 focus:border-primary-500 sm:text-sm px-4 py-2 bg-slate-50" placeholder="Any additional requirements or notes..."></textarea>
        </div>
      </div>
    </div>

    <!-- Actions Area -->
    <div class="flex items-center justify-end space-x-4 pt-4 border-t border-slate-200 mt-8">
      <button type="button" (click)="location.back()" class="btn btn-secondary px-6">
        Cancel
      </button>
      <button type="submit" [disabled]="form.invalid || saving" class="btn btn-primary shadow-glow px-10 relative">
        <span [class.opacity-0]="saving">{{ isEditMode ? 'Update Record' : 'Save Booking' }}</span>
        
        <svg *ngIf="saving" class="animate-spin h-5 w-5 absolute top-1/2 left-1/2 -ml-2.5 -mt-2.5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
        </svg>
      </button>
    </div>
    
  </form>
</div>
